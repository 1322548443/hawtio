<div>
  <div class="active-profile-titles section-header">
    <div class="active-profile-name">Name</div>
    <div class="active-profile-filter">
      <div class="section-filter">
        <input type="text" class="search-query" placeholder="Filter..." ng-model="searchFilter">
        <i class="icon-remove clickable" title="Clear Filter" ng-click="containerIdFilter = ''"></i>
      </div>
    </div>

    <div class="section-controls">
      <a href="" title="Create a new container" ng-click="createContainer()">
        <i class="icon-plus"></i> Create
      </a>
      <a href="" ng-click="editRequirements.dialogOpen(null)" title="Configure the minimum number of required instances for each profile. If you are on OpenShift or using an Auto Scaler they are then created automatically; otherwise click on the count button to manually provision required containers">
        <i class="icon-resize-vertical"></i>
        Scale
      </a>
    </div>

    <div class="active-profile-count" title="The actual number of instances of each profile that are currently running">Count</div>

  </div>
  <div class="active-profile-list" ng-repeat="profile in activeProfiles" ng-show="profileMatchesFilter(profile)">
    <div class="expandable" ng-class="isOpen(profile)">
      <div class="active-profile-row">
        <div class="title active-profile-expander">
          <i class="expandable-indicator" ng-show="profile.count"></i>
        </div>
        <div class="title active-profile-icon">
          <i class="icon-book"></i>
        </div>
        <div class="title active-profile-name">
          <a href="" ng-click="showProfile(profile)">{{profile.id}}</a> / {{profile.versionId}}
        </div>
        <div class="active-profile-count" title="Current number of instances of this profile. Click to create more containers">
          <a href="" ng-click="createRequiredContainers(profile)">
            <span class="badge {{profile.requireStyle}}" >
              {{profile.count}}
            </span>
          </a>
        </div>

        <div class="active-profile-requirements">
          <a ng-click="editRequirements.dialogOpen(profile)">
          <span ng-show="profile.requirements.minimumInstances" class="badge" title="The minimum number of required instances of this profile. If you use OpenShift or run an Auto Scaler then this many instances will be created automatically.">
            {{profile.requirements.minimumInstances}}
          </span>
          </a>
        </div>

      </div>
      <div class="expandable-body">
        <ul>
          <li class="no-list" ng-repeat="container in containersForProfile(profile.id)" ng-show="containerMatchesFilter(container)">

            <div class="box" ng-class="getSelectedClass(container)">

              <div class="box-left">

                <i ng-show="!container.selected && showSelect" class="icon-circle-blank clickable" title="Not Selected" ng-click="container.selected = true"></i>
                <i ng-show="container.selected && showSelect" class="icon-circle clickable" title="Status of the container" ng-click="container.selected = false"></i>

                <i class="clickable" title="{{getStatusTitle(container)}}" ng-class='statusIcon(container)' ng-click="container.selected = !container.selected"></i>

                <div ng-click="container.selected = !container.selected">
                  <a ng-click="showContainer(container)">{{container.id}}</a> / {{container.versionId}}
                </div>

                <i class="icon-cloud clickable" title="Ensemble member" ng-click="showContainer(container)" ng-show="isEnsembleContainer(container.id)"></i>
              </div>

              <div class="box-middle">
                <ul class="inline">
                  <li ng-repeat="service in container.services" ng-switch="service.type">
                    <i ng-switch-when="icon" class="{{service.src}}" title="{{service.title}}"></i>
                    <img ng-switch-when="img" ng-src="{{service.src}}" title="{{service.title}}">
                  </li>
                </ul>
              </div>

              <div class="box-right">

                <i class="icon-plus clickable" ng-show="container.root && container.alive" title="Create a new child container" ng-click="createChildContainer(container)"></i>

                <i class="icon-signin clickable" ng-show="container.jolokiaUrl && container.alive" title="Open a new window and connect to this container" ng-click="doConnect(container)"></i>
              </div>

            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div modal="editRequirements.dialog.show">
    <form name="requirementsForm" class="form-inline no-bottom-margin">
      <div class="modal-header"><h4>Edit Requirements</h4></div>
      <div class="modal-body">
        <table>
          <thead>
            <th>Profile</th>
            <th title="Minimum number of instances which should be running">Minimum</th>
            <th title="Maximum number of instances">Maximum</th>
            <th title="Profiles which must be provisioned first before this profile">Dependent Profiles</th>
          </thead>
          <tbody>
            <tr ng-repeat="requirement in editRequirements.entity.profileRequirements">
              <td class="property-name">{{requirement.profile}}</td>
              <td>
                <input name="minimumInstances" type="number" ng-model="requirement.minimumInstances" ng-required="false" class="input-small">
              </td>
              <td>
                <input name="maximumInstances" type="number" ng-model="requirement.maximumInstances" ng-required="false" class="input-small">
              </td>
              <td>
                <div ng-hide="editRequirements.addDependentDialogProfile == requirement.profile">
                  <div ng-repeat="dependentProfile in requirement.dependentProfiles">
                    <i class="red clickable icon-remove" title="Removes this dependent profile"
                       ng-click="requirement.dependentProfiles.remove(dependentProfile)"></i>
                    <span class="dependent-profile">{{dependentProfile}}</span>
                  </div>
                  <i class="clickable icon-edit green" ng-click="editRequirements.addProfileDialogShow(requirement)"
                     title="Add new dependent profiles to this profile"></i>
                </div>

                <div ng-show="editRequirements.addDependentDialogProfile == requirement.profile">
                  <div class="btn-group">
                    <button class="btn" ng-disabled="editRequirements.selectedDependentProfiles.length == 0"
                            ng-click="editRequirements.addSelectedDependentProfiles(requirement)">
                      <i class="icon-plus"></i> Add
                    </button>
                    <button class="btn" ng-click="editRequirements.addProfileDialogHide()">Cancel</button>
                  </div>

                  <div fabric-profile-selector="editRequirements.selectedDependentProfiles"
                       version-id="editRequirements.versionId"
                       excluded-profiles="editRequirements.excludeProfiles"></div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <input class="btn btn-success" ng-disabled="!requirementsForm.$valid" ng-click="updateRequirements(editRequirements.entity)" value="Update">
        <input class="btn btn-primary" ng-click="editRequirements.dialog.close()" value="Cancel">
      </div>
    </form>


  </div>

</div>
